ktor {
    deployment {
        port = 8080
        port = ${?PORT}
    }
    application {
        modules = [ com.task.ApplicationKt.module ]
    }
}

database {
    driverClassName = "org.postgresql.Driver"
    
    # ローカル開発用デフォルト値
    host = "localhost"
    host = ${?PGHOST}
    port = 5432
    port = ${?PGPORT}
    name = "housework"
    name = ${?PGDATABASE}
    
    # JDBC URL を個別の変数から構築
    # Railway では PGHOST, PGPORT, PGDATABASE が自動的に提供される
    jdbcUrl = "jdbc:postgresql://"${database.host}":"${database.port}"/"${database.name}
    
    # JDBC_DATABASE_URL が設定されている場合はそちらを優先（手動設定用）
    jdbcUrl = ${?JDBC_DATABASE_URL}
    
    username = "housework"
    username = ${?PGUSER}
    password = "housework_password"
    password = ${?PGPASSWORD}
    maximumPoolSize = 10
}

jwt {
    secret = "your-256-bit-secret-key-for-development"
    secret = ${?JWT_SECRET}
    issuer = "housework-app"
    audience = "housework-users"
    realm = "Housework API"
    expiresInMs = 604800000  # 7日間 (7 * 24 * 60 * 60 * 1000)
}

# メール送信設定
# Gmail SMTP を使用する場合:
#   1. Google アカウントで2段階認証を有効化
#   2. アプリパスワードを生成: https://myaccount.google.com/apppasswords
#   3. 環境変数を設定
mail {
    # "smtp" を指定すると実際にメール送信、"logging" を指定するとログ出力のみ
    provider = "logging"
    provider = ${?MAIL_PROVIDER}
    
    smtp {
        host = "smtp.gmail.com"
        host = ${?SMTP_HOST}
        port = 587
        port = ${?SMTP_PORT}
        # TLS設定
        # - Gmail: 通常 587(STARTTLS) or 465(SSL)
        useStartTls = true
        useStartTls = ${?SMTP_USE_STARTTLS}
        startTlsRequired = true
        startTlsRequired = ${?SMTP_STARTTLS_REQUIRED}
        useSsl = false
        useSsl = ${?SMTP_USE_SSL}
        sslTrust = ${?SMTP_SSL_TRUST}
        # タイムアウト(ms)
        connectionTimeoutMs = 10000
        connectionTimeoutMs = ${?SMTP_CONNECTION_TIMEOUT_MS}
        timeoutMs = 10000
        timeoutMs = ${?SMTP_TIMEOUT_MS}
        username = ""
        username = ${?SMTP_USER}
        password = ""
        password = ${?SMTP_PASSWORD}
        fromAddress = ""
        fromAddress = ${?SMTP_FROM_ADDRESS}
        fromName = "Housework App"
        fromName = ${?SMTP_FROM_NAME}
    }
}
